---
title: "Data Storage Tags"
execute:
  echo: false
  include: false
output:
  html_document:
    df_print: paged
    theme: readable
    # toc_float: true
    toc: true
    # number_sections: false
    # toc_depth: 2
description: "Exploratory analysis progress of the DST data, i.e. the depth and temperature logs of the tags that were recovered."
date: 2.27.2023
editor_options:
  chunk_output_type: console
knitr:
  opts_chunk: 
    collapse: true
format: 
  html:
    page-layout: article
    # code-tools: true
    fig-width: 8
    fig-height: 5
    toc: true
image: image.PNG
---

```{r libraries}
#| include: false
library(tidyverse)
library(lubridate)
library(leaflet)
library(tibble)
library(stringr)
library(ggsci)
library(pander)
library(mregions2)
library(fuzzyjoin)
library(sf)
library(plotly)

```

```{r settings_knitting}
rm(list = ls())
dir_path <- "C:/Users/lotte.pohl/Documents/github_repos/ADST_Mustelus_asterias"
path_envdata <- paste0(dir_path, "/03_data/environmental_layers/")
path_boundaries <- paste0(dir_path, "/03_data/marine_boundaries/")
```

```{r load_functions}
source(paste0(dir_path, "/functions.R"))
source(paste0(dir_path, "/functions/functions_DST_presstemplogs.R"))
# make into file in `wrangle_data` folder
```

```{r load_data}
source(paste0(dir_path, "/02_scripts/02_load_data/load_environmental_data.R"))
source(paste0(dir_path, "/02_scripts/02_load_data/load_human_activities.R"))
source(paste0(dir_path, "/02_scripts/02_load_data/load_marine_boundaries.R"))
source(paste0(dir_path, "/02_scripts/02_load_data/load_acoustic_detections.R"))
source(paste0(dir_path, "/02_scripts/02_load_data/load_depth_temp_logs.R"))
source(paste0(dir_path, "/02_scripts/02_load_data/load_dst_geolocation_output.R"))
```

```{r setup}
#| include: false
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```

<!-- ```{r read_DST} -->
<!-- #| include: false -->
<!-- # mpt_1293295_Det0 <- read_csv("../dst_data/01_modelled_tracks/1293295/Sat0_Catch1_Det0_Behav0_res1.0/D_mle/Tracks/MA_SN1293295_mpt_track_positions.csv", show_col_types = FALSE) -->
<!-- # tag 295 #### -->
<!-- mpt_1293295_Det1 <- read_csv(paste0(dir_path, "/dst_data/01_modelled_tracks/1293295/Sat0_Catch1_Det1_Behav0_res1.0/D_mle/Tracks/MA_SN1293295_mpt_track_positions.csv"), show_col_types = FALSE) %>% mutate(tag_serial_number = "1293295") -->
<!-- mode_1293295_Det1 <- read_csv(paste0(dir_path, "/dst_data/01_modelled_tracks/1293295/Sat0_Catch1_Det1_Behav0_res1.0/D_mle/Tracks/MA_SN1293295_mode_track_positions.csv"), show_col_types = FALSE) %>% mutate(tag_serial_number = "1293295") -->
<!-- mean_1293295_Det1 <- read_csv(paste0(dir_path, "/dst_data/01_modelled_tracks/1293295/Sat0_Catch1_Det1_Behav0_res1.0/D_mle/Tracks/MA_SN1293295_mean_track_positions.csv"), show_col_types = FALSE) %>% mutate(tag_serial_number = "1293295") -->

<!-- all_295_Det1 <- mpt_1293295_Det1 %>% left_join(mean_1293295_Det1 %>% dplyr::select(date, long_dg, lat_dg), by = "date") %>% left_join(mode_1293295_Det1 %>% dplyr::select(date, long_dg, lat_dg), by = "date") -->
<!-- rm(mpt_1293295_Det1, mean_1293295_Det1, mode_1293295_Det1) -->

<!-- # tag 304 #### -->
<!-- mpt_1293304_Det0 <- read_csv(paste0(dir_path, "/dst_data/01_modelled_tracks/1293304/Sat0_Catch1_Det0_Behav0_res1.0/D_mle/Tracks/MA_SN1293304_mpt_track_positions.csv"), show_col_types = FALSE) %>% mutate(tag_serial_number = "1293304") -->
<!-- mode_1293304_Det0 <- read_csv(paste0(dir_path, "/dst_data/01_modelled_tracks/1293304/Sat0_Catch1_Det0_Behav0_res1.0/D_mle/Tracks/MA_SN1293304_mode_track_positions.csv"), show_col_types = FALSE) %>% mutate(tag_serial_number = "1293304") -->
<!-- mean_1293304_Det0 <- read_csv(paste0(dir_path, "/dst_data/01_modelled_tracks/1293304/Sat0_Catch1_Det0_Behav0_res1.0/D_mle/Tracks/MA_SN1293304_mean_track_positions.csv"), show_col_types = FALSE) %>% mutate(tag_serial_number = "1293304") -->

<!-- all_304_Det0 <- mpt_1293304_Det0 %>% left_join(mean_1293304_Det0 %>% dplyr::select(date, long_dg, lat_dg), by = "date") %>% left_join(mode_1293304_Det0 %>% dplyr::select(date, long_dg, lat_dg), by = "date") -->
<!-- rm(mpt_1293304_Det0, mean_1293304_Det0, mode_1293304_Det0) -->

<!-- # tag 308 #### -->
<!-- mpt_1293308_Det1 <- read_csv(paste0(dir_path, "/dst_data/01_modelled_tracks/1293308/Sat0_Catch1_Det1_Behav0_res1.0/D_mle/Tracks/MA_SN1293308_mpt_track_positions.csv"), show_col_types = FALSE) %>% mutate(tag_serial_number = "1293308") -->
<!-- mode_1293308_Det1 <- read_csv(paste0(dir_path, "/dst_data/01_modelled_tracks/1293308/Sat0_Catch1_Det1_Behav0_res1.0/D_mle/Tracks/MA_SN1293308_mode_track_positions.csv"), show_col_types = FALSE) %>% mutate(tag_serial_number = "1293308") -->
<!-- mean_1293308_Det1 <- read_csv(paste0(dir_path, "/dst_data/01_modelled_tracks/1293308/Sat0_Catch1_Det1_Behav0_res1.0/D_mle/Tracks/MA_SN1293308_mean_track_positions.csv"), show_col_types = FALSE) %>% mutate(tag_serial_number = "1293308") -->

<!-- all_308_Det1 <- mpt_1293308_Det1 %>% left_join(mean_1293308_Det1 %>% dplyr::select(date, long_dg, lat_dg), by = "date") %>% left_join(mode_1293308_Det1 %>% dplyr::select(date, long_dg, lat_dg), by = "date") -->
<!-- rm(mpt_1293308_Det1, mean_1293308_Det1, mode_1293308_Det1) -->

<!-- # tag 310 #### -->
<!-- mpt_1293310_Det0 <- read_csv(paste0(dir_path, "/dst_data/01_modelled_tracks/1293310/Sat0_Catch1_Det0_Behav0_res1.0/D_mle/Tracks/MA_SN1293310_mpt_track_positions.csv"), show_col_types = FALSE) %>% mutate(tag_serial_number = "1293310") -->
<!-- mode_1293310_Det0 <- read_csv(paste0(dir_path, "/dst_data/01_modelled_tracks/1293310/Sat0_Catch1_Det0_Behav0_res1.0/D_mle/Tracks/MA_SN1293310_mode_track_positions.csv"), show_col_types = FALSE) %>% mutate(tag_serial_number = "1293310") -->
<!-- mean_1293310_Det0 <- read_csv(paste0(dir_path, "/dst_data/01_modelled_tracks/1293310/Sat0_Catch1_Det0_Behav0_res1.0/D_mle/Tracks/MA_SN1293310_mean_track_positions.csv"), show_col_types = FALSE) %>% mutate(tag_serial_number = "1293310") -->

<!-- all_310_Det0 <- mpt_1293310_Det0 %>% left_join(mean_1293310_Det0 %>% dplyr::select(date, long_dg, lat_dg), by = "date") %>% left_join(mode_1293310_Det0 %>% dplyr::select(date, long_dg, lat_dg), by = "date") -->
<!-- rm(mpt_1293310_Det0, mean_1293310_Det0, mode_1293310_Det0) -->

<!-- # tag 312 #### -->
<!-- mpt_1293312_Det0 <- read_csv(paste0(dir_path, "/dst_data/01_modelled_tracks/1293312/Sat0_Catch1_Det0_Behav0_res1.0/D_mle/Tracks/MA_SN1293312_mpt_track_positions.csv"), show_col_types = FALSE) %>% mutate(tag_serial_number = "1293312") -->
<!-- mode_1293312_Det0 <- read_csv(paste0(dir_path, "/dst_data/01_modelled_tracks/1293312/Sat0_Catch1_Det0_Behav0_res1.0/D_mle/Tracks/MA_SN1293312_mode_track_positions.csv"), show_col_types = FALSE) %>% mutate(tag_serial_number = "1293312") -->
<!-- mean_1293312_Det0 <- read_csv(paste0(dir_path, "/dst_data/01_modelled_tracks/1293312/Sat0_Catch1_Det0_Behav0_res1.0/D_mle/Tracks/MA_SN1293312_mean_track_positions.csv"), show_col_types = FALSE) %>% mutate(tag_serial_number = "1293312") -->

<!-- all_312_Det0 <- mpt_1293312_Det0 %>% left_join(mean_1293312_Det0 %>% dplyr::select(date, long_dg, lat_dg), by = "date") %>% left_join(mode_1293312_Det0 %>% dplyr::select(date, long_dg, lat_dg), by = "date") -->
<!-- rm(mpt_1293312_Det0, mean_1293312_Det0, mode_1293312_Det0) -->

<!-- # tag 319 #### -->
<!-- # mpt_1293319_Det0 <- read_csv("../dst_data/01_modelled_tracks/1293319/Sat0_Catch1_Det0_Behav0_res1.0/D_mle/Tracks/MA_SN1293319_mpt_track_positions.csv"), show_col_types = FALSE) -->
<!-- mpt_1293319_Det1 <- read_csv(paste0(dir_path, "/dst_data/01_modelled_tracks/1293319/Sat0_Catch1_Det1_Behav0_res1.0/D_mle/Tracks/MA_SN1293319_mpt_track_positions.csv"), show_col_types = FALSE) %>% mutate(tag_serial_number = "1293319") -->
<!-- mode_1293319_Det1 <- read_csv(paste0(dir_path, "/dst_data/01_modelled_tracks/1293319/Sat0_Catch1_Det1_Behav0_res1.0/D_mle/Tracks/MA_SN1293319_mode_track_positions.csv"), show_col_types = FALSE) %>% mutate(tag_serial_number = "1293319") -->
<!-- mean_1293319_Det1 <- read_csv(paste0(dir_path, "/dst_data/01_modelled_tracks/1293319/Sat0_Catch1_Det1_Behav0_res1.0/D_mle/Tracks/MA_SN1293319_mean_track_positions.csv"), show_col_types = FALSE) %>% mutate(tag_serial_number = "1293319") -->

<!-- all_319_Det1 <- mpt_1293319_Det1 %>% left_join(mean_1293319_Det1 %>% dplyr::select(date, long_dg, lat_dg), by = "date") %>% left_join(mode_1293319_Det1 %>% dplyr::select(date, long_dg, lat_dg), by = "date") -->
<!-- rm(mpt_1293319_Det1, mean_1293319_Det1, mode_1293319_Det1) -->

<!-- # tag 321 #### -->
<!-- mpt_1293321_Det1 <- read_csv(paste0(dir_path, "/dst_data/01_modelled_tracks/1293321/Sat0_Catch1_Det1_Behav0_res1.0/D_mle/Tracks/MA_SN1293321_mpt_track_positions.csv"), show_col_types = FALSE) %>% mutate(tag_serial_number = "1293321") -->
<!-- mode_1293321_Det1 <- read_csv(paste0(dir_path, "/dst_data/01_modelled_tracks/1293321/Sat0_Catch1_Det1_Behav0_res1.0/D_mle/Tracks/MA_SN1293321_mode_track_positions.csv"), show_col_types = FALSE) %>% mutate(tag_serial_number = "1293321") -->
<!-- mean_1293321_Det1 <- read_csv(paste0(dir_path, "/dst_data/01_modelled_tracks/1293321/Sat0_Catch1_Det1_Behav0_res1.0/D_mle/Tracks/MA_SN1293321_mean_track_positions.csv"), show_col_types = FALSE) %>% mutate(tag_serial_number = "1293321") -->

<!-- all_321_Det1 <- mpt_1293321_Det1 %>% left_join(mean_1293321_Det1 %>% dplyr::select(date, long_dg, lat_dg), by = "date") %>% left_join(mode_1293321_Det1 %>% dplyr::select(date, long_dg, lat_dg), by = "date") -->
<!-- rm(mpt_1293321_Det1, mean_1293321_Det1, mode_1293321_Det1) -->

<!-- # tag 322 #### -->
<!-- mpt_1293322_Det1 <- read_csv(paste0(dir_path, "/dst_data/01_modelled_tracks/1293322/Sat0_Catch1_Det1_Behav0_res1.0/D_mle/Tracks/MA_SN1293322_mpt_track_positions.csv"), show_col_types = FALSE) %>% mutate(tag_serial_number = "1293322") -->
<!-- mode_1293322_Det1 <- read_csv(paste0(dir_path, "/dst_data/01_modelled_tracks/1293322/Sat0_Catch1_Det1_Behav0_res1.0/D_mle/Tracks/MA_SN1293322_mode_track_positions.csv"), show_col_types = FALSE) %>% mutate(tag_serial_number = "1293322") -->
<!-- mean_1293322_Det1 <- read_csv(paste0(dir_path, "/dst_data/01_modelled_tracks/1293322/Sat0_Catch1_Det1_Behav0_res1.0/D_mle/Tracks/MA_SN1293322_mean_track_positions.csv"), show_col_types = FALSE) %>% mutate(tag_serial_number = "1293322") -->

<!-- all_322_Det1 <- mpt_1293322_Det1 %>% left_join(mean_1293322_Det1 %>% dplyr::select(date, long_dg, lat_dg), by = "date") %>% left_join(mode_1293322_Det1 %>% dplyr::select(date, long_dg, lat_dg), by = "date") -->
<!-- rm(mpt_1293322_Det1, mean_1293322_Det1, mode_1293322_Det1) -->
<!-- ``` -->

<!-- ```{r wrangle_dst_data} -->
<!-- #| include: false -->
<!-- # make one df combining all DST trajectories -->
<!-- # mpts_all <- rbind(mpt_1293295_Det1, mpt_1293304_Det0, mpt_1293308_Det1, mpt_1293310_Det0, mpt_1293312_Det0, mpt_1293319_Det1, mpt_1293321_Det1, mpt_1293322_Det1) %>% rename(detection_latitude = lat_dg, detection_longitude = long_dg, date_time = date) %>% dplyr::select(tag_serial_number, detection_latitude, detection_longitude, date_time) -->

<!-- mpts_all <- rbind(all_295_Det1, all_304_Det0, all_308_Det1, all_310_Det0, all_312_Det0, all_319_Det1, all_321_Det1, all_322_Det1) %>%  -->
<!--   rename(detection_latitude = lat_dg.x, detection_longitude = long_dg.x, -->
<!--          detection_latitude_mean = lat_dg.y, detection_longitude_mean = long_dg.y, -->
<!--          detection_latitude_mode = lat_dg, detection_longitude_mode = long_dg, -->
<!--          date_time = date) %>% -->
<!--   dplyr::select(tag_serial_number, date_time, detection_latitude, detection_longitude, detection_latitude_mean, detection_longitude_mean, detection_latitude_mode, detection_longitude_mode) -->


<!-- # change date format -->
<!-- mpts_all$date <- mpts_all$date_time %>% format("%m-%d") -->
<!-- # mpts_all$tag_serial_number <- mpts_all$tag_serial_number %>% as.factor() -->
<!-- # mpts_all$tag_serial_number <- mpts_all$tag_serial_number %>% as.character() -->

<!-- mpts_all <- mpts_all %>% left_join(masterias_info %>% dplyr::select(tag_serial_number, sex, life_stage, length1, weight), by = "tag_serial_number") -->

<!-- mpts_short <- mpts_all %>% filter(!tag_serial_number %in% c("1293308", "1293321")) -->

<!-- # # change date to 2018 of 3 animals tagged 2019 -->
<!-- # mpts_2019 <- rbind(mpt_1293304_Det0, mpt_1293310_Det0, mpt_1293312_Det0) -->
<!-- # mpts_2019$date <- mpts_2019$date - years(1) -->
<!-- #    -->
<!-- # mpts_short <- rbind(mpts_2019, mpt_1293295_Det1, mpt_1293319_Det1, mpt_1293322_Det1) %>% -->
<!-- #   rename(detection_latitude = lat_dg, detection_longitude = long_dg, date_time = date) %>% dplyr::select(tag_serial_number, detection_latitude, detection_longitude, date_time) -->


<!-- # remove single files -->
<!-- # rm(mpt_1293295_Det1, mpt_1293304_Det0, mpt_1293308_Det1, mpt_1293310_Det0, mpt_1293312_Det0, mpt_1293319_Det1, mpt_1293321_Det1, mpt_1293322_Det1) -->
<!-- rm(all_295_Det1, all_304_Det0, all_308_Det1, all_310_Det0, all_312_Det0, all_319_Det1, all_321_Det1, all_322_Det1) -->
<!-- ``` -->


```{r info sharks}
summary_masterias_length <- masterias_info %>% group_by(sex) %>% summarise(mean_length = length1 %>% mean(), sd_length = length1 %>% sd())

mpts_short <- masterias_dst_geolocation_output %>% filter(!tag_serial_number %in% c("1292308", "1293321"))
```

<!-- Males had a total length (TL) of `r summary_masterias_length %>% filter(sex == "m") %>% dplyr::select(mean_length) %>% round(digits = 2) %>% pull()` cm ($\pm$ `r summary_masterias_length %>% filter(sex == "m") %>% dplyr::select(sd_length) %>% round(digits = 2) %>% pull()`, n = `r masterias_info %>% filter(sex == "m") %>% nrow()`). -->

<!-- Females had a TL of `r summary_masterias_length %>% filter(sex == "f") %>% dplyr::select(mean_length) %>% round(digits = 2) %>% pull()` cm ($\pm$ `r summary_masterias_length %>% filter(sex == "f") %>% dplyr::select(sd_length) %>% round(digits = 2) %>% pull()`, n = `r masterias_info %>% filter(sex == "f") %>% nrow()`). -->

::: column-body-outset
## where we left off

6 out of 8 recovered tags stopped recording 13-38 days after tagging, i.e. the animal died.

::: {.panel-tabset}
### map

```{r shortterm_longterm_map}
#| include: true

# for emodnet layer
emodnet_tiles <-"https://tiles.emodnet-bathymetry.eu/2020/baselayer/web_mercator/{z}/{x}/{y}.png"
cite_emodnet <- "<a href='https://emodnet.ec.europa.eu'>EMODnet</a>"
  attr(cite_emodnet, "class") <- c("html", "character")
  

col_fun <- ggsci::pal_locuszoom()(mpts_short$tag_serial_number %>% unique() %>% length())
pal <- leaflet::colorFactor(col_fun, domain = mpts_short$tag_serial_number)

# for the long term DST tracks
pal_dst <- colorNumeric(palette = "magma", domain = c(masterias_dst_geolocation_output$date_time %>% min(), masterias_detections_clean$date_time %>% max())) # mpts_all$date_time, masterias_detections_clean$date_time

# mpts_short <- mpts_all %>% filter(!tag_serial_number == c("1293308", "1293321"))
legend_dates = c("2018-08-01", "2018-11-01", "2019-02-01", "2019-05-01", "2019-08-01", "2019-11-01")


map_dst <- leaflet::leaflet(
  # options = leaflet::leafletOptions(crs = leaflet::leafletCRS("L.CRS.EPSG4326"))
                                  ) %>%
  # ADD BASELAYERS ####
  addProviderTiles("Esri.WorldImagery", options = providerTileOptions(opacity = 0.6), group = "satellite") %>%
  leaflet::addTiles(urlTemplate = emodnet_tiles,
      # options = leaflet::tileOptions(tms = FALSE),
      attribution = cite_emodnet,
      group = "EMODnet bathymetry") %>%
  # SCALEBAR ####
  addScaleBar(position = "topright", options = scaleBarOptions(maxWidth = 250, imperial = F)) %>%
  setView(3.3, 51.5, zoom = 8) %>% 
  #### BPNS ####
  addPolygons(data = BPNS, color = "grey", 
              weight = 2,
              opacity = 1.0,
              fillOpacity = 0, 
              group = "Regions") %>%
    #### submarine cables ####
  addPolylines(data = cables,
               color = "blue",
               opacity = 0.15,
               label = ~name,
               group = "wrecks, OWFs, cables") %>%
  #### windfarms ####
  addPolygons(data = windfarms_polygons %>% filter(!status %in% c("Approved", "Planned")),
              color = "red",
              weight = 2,
              opacity = 1,
              fillOpacity = 0.3,
              label = ~paste0("status: ", status, ", country: ", country, ", year: ", year),
              group = "wrecks, OWFs, cables") %>%
  #### shipwrecks ####
  addCircleMarkers(data = wrecks,
                 fillColor = "lightgreen",
                 opacity = 0,
                 fillOpacity = 1,
                 radius = 3,
                 label = ~paste0("Object: ", obj_type, ", sink year: ", sink_yr),
                 group = "wrecks, OWFs, cables") %>%
  addCircleMarkers(data = wrecks_BE %>% filter(Staat != "Geborgen"),
                   lng = ~longitude,
                   lat = ~latitude,
                   fillColor = "lightgreen",
                   opacity = 0,
                   fillOpacity = 1,
                   radius = 3,
                   label = ~paste0("Object: ", Type, ", sink date: ", sink_yr, ", status: ", Staat, ", material: ", Materiaal, ", name: ", Naam),
                   group = "wrecks, OWFs, cables") %>%
  # add tag 295 #####
    addPolylines(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293295"),
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               color = ~pal(tag_serial_number),
               weight = 3,
               opacity = 0.6,
               label = ~tag_serial_number,
               group = "<span style=color:#D43F3A>tag 295</span>") %>%
  addPolylines(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293295"),
               lat = ~detection_latitude_mean,
               lng = ~detection_longitude_mean,
               color = ~pal(tag_serial_number),
               weight = 1,
               fillOpacity = 0.2,
               opacity = 0.2,
               dashArray = "5,5",
               label = ~paste0(tag_serial_number, ", mean track"),
               group = "mean tracks") %>%
  addPolylines(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293295"),
               lat = ~detection_latitude_mode,
               lng = ~detection_longitude_mode,
               color = ~pal(tag_serial_number),
               weight = 1,
               fillOpacity = 0.3,
               dashArray = "1,7",
               label = ~paste0(tag_serial_number, ", mode track"),
               group = "mode tracks") %>%
  addCircleMarkers(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293295"),
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               fillColor = ~pal(tag_serial_number),
               radius = 5,
               weight = 0,
               fillOpacity = 0.8,
               label = ~paste0(format(date_time,"%F"), ", ", sex),
               group = "<span style=color:#D43F3A>tag 295</span>") %>%
  # add tag 304 #####
    addPolylines(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293304"),
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               color = ~pal(tag_serial_number),
               weight = 3,
               opacity = 0.6,
               label = ~tag_serial_number,
               group = "<span style=color:#EEA236>tag 304</span>") %>%
    addPolylines(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293304"),
               lat = ~detection_latitude_mean,
               lng = ~detection_longitude_mean,
               color = ~pal(tag_serial_number),
               weight = 1,
               fillOpacity = 0.2,
               opacity = 0.2,
               dashArray = "5,5",
               label = ~paste0(tag_serial_number, ", mean track"),
               group = "mean tracks") %>%
  addPolylines(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293304"),
               lat = ~detection_latitude_mode,
               lng = ~detection_longitude_mode,
               color = ~pal(tag_serial_number),
               weight = 1,
               fillOpacity = 0.3,
               dashArray = "1,7",
               label = ~paste0(tag_serial_number, ", mode track"),
               group = "mode tracks") %>%
  addCircleMarkers(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293304"),
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               fillColor = ~pal(tag_serial_number),
               radius = 5,
               weight = 0,
               fillOpacity = 0.8,
               label = ~paste0(format(date_time,"%F"), ", ", sex),
               group = "<span style=color:#EEA236>tag 304</span>") %>%
  # add tag 310 #####
    addPolylines(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293310"),
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               color = ~pal(tag_serial_number),
               weight = 3,
               opacity = 0.6,
               label = ~tag_serial_number,
               group = "<span style=color:#5CB85C>tag 310</span>") %>%
    addPolylines(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293310"),
               lat = ~detection_latitude_mean,
               lng = ~detection_longitude_mean,
               color = ~pal(tag_serial_number),
               weight = 1,
               fillOpacity = 0.2,
               opacity = 0.2,
               dashArray = "5,5",
               label = ~paste0(tag_serial_number, ", mean track"),
               group = "mean tracks") %>%
  addPolylines(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293310"),
               lat = ~detection_latitude_mode,
               lng = ~detection_longitude_mode,
               color = ~pal(tag_serial_number),
               weight = 1,
               fillOpacity = 0.3,
               dashArray = "1,7",
               label = ~paste0(tag_serial_number, ", mode track"),
               group = "mode tracks") %>%
  addCircleMarkers(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293310"),
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               fillColor = ~pal(tag_serial_number),
               radius = 5,
               weight = 0,
               fillOpacity = 0.8,
               label = ~paste0(format(date_time,"%F"), ", ", sex),
               group = "<span style=color:#5CB85C>tag 310</span>") %>%
  # add tag 312 #####
    addPolylines(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293312"),
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               color = ~pal(tag_serial_number),
               weight = 3,
               opacity = 0.6,
               label = ~tag_serial_number,
               group = "<span style=color:#46B8DA>tag 312</span>") %>%
    addPolylines(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293312"),
               lat = ~detection_latitude_mean,
               lng = ~detection_longitude_mean,
               color = ~pal(tag_serial_number),
               weight = 1,
               fillOpacity = 0.2,
               opacity = 0.2,
               dashArray = "5,5",
               label = ~paste0(tag_serial_number, ", mean track"),
               group = "mean tracks") %>%
  addPolylines(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293312"),
               lat = ~detection_latitude_mode,
               lng = ~detection_longitude_mode,
               color = ~pal(tag_serial_number),
               weight = 1,
               fillOpacity = 0.3,
               dashArray = "1,7",
               label = ~paste0(tag_serial_number, ", mode track"),
               group = "mode tracks") %>%
  addCircleMarkers(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293312"),
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               fillColor = ~pal(tag_serial_number),
               radius = 5,
               weight = 0,
               fillOpacity = 0.8,
               label = ~paste0(format(date_time,"%F"), ", ", sex),
               group = "<span style=color:#46B8DA>tag 312</span>") %>%
  # add tag 319 #####
    addPolylines(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293319"),
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               color = ~pal(tag_serial_number),
               weight = 3,
               opacity = 0.6,
               label = ~tag_serial_number,
               group = "<span style=color:#357EBD>tag 319</span>") %>%
    addPolylines(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293319"),
               lat = ~detection_latitude_mean,
               lng = ~detection_longitude_mean,
               color = ~pal(tag_serial_number),
               weight = 1,
               fillOpacity = 0.2,
               opacity = 0.2,
               dashArray = "5,5",
               label = ~paste0(tag_serial_number, ", mean track"),
               group = "mean tracks") %>%
  addPolylines(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293319"),
               lat = ~detection_latitude_mode,
               lng = ~detection_longitude_mode,
               color = ~pal(tag_serial_number),
               weight = 1,
               fillOpacity = 0.3,
               dashArray = "1,7",
               label = ~paste0(tag_serial_number, ", mode track"),
               group = "mode tracks") %>%
  addCircleMarkers(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293319"),
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               fillColor = ~pal(tag_serial_number),
               radius = 5,
               weight = 0,
               fillOpacity = 0.8,
               label = ~paste0(format(date_time,"%F"), ", ", sex),
               group = "<span style=color:#357EBD>tag 319</span>") %>%
  # add tag 322 #####
    addPolylines(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293322"),
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               color = ~pal(tag_serial_number),
               weight = 3,
               opacity = 0.6,
               label = ~tag_serial_number,
               group = "<span style=color:#9632B8>tag 322</span>") %>%
    addPolylines(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293322"),
               lat = ~detection_latitude_mean,
               lng = ~detection_longitude_mean,
               color = ~pal(tag_serial_number),
               weight = 1,
               fillOpacity = 0.2,
               opacity = 0.2,
               dashArray = "5,5",
               label = ~paste0(tag_serial_number, ", mean track"),
               group = "mean tracks") %>%
  addPolylines(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293322"),
               lat = ~detection_latitude_mode,
               lng = ~detection_longitude_mode,
               color = ~pal(tag_serial_number),
               weight = 1,
               fillOpacity = 0.3,
               dashArray = "1,7",
               label = ~paste0(tag_serial_number, ", mode track"),
               group = "mode tracks") %>%
  addCircleMarkers(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293322"),
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               fillColor = ~pal(tag_serial_number),
               radius = 5,
               weight = 0,
               fillOpacity = 0.8,
               label = ~paste0(format(date_time,"%F"), ", ", sex),
               group = "<span style=color:#9632B8>tag 322</span>") %>%

  # add tag 308 ####
    addPolylines(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293308"),
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               color = "#B5B5B5",
               weight = 3,
               opacity = 0.6,
               label = ~tag_serial_number,
               group = "<span style=color:#B5B5B5>tag 308 (female)</span>") %>%
    addPolylines(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293308"),
               lat = ~detection_latitude_mean,
               lng = ~detection_longitude_mean,
               color = "#B5B5B5",
               weight = 1,
               fillOpacity = 0.2,
               opacity = 0.2,
               dashArray = "5,5",
               label = ~paste0(tag_serial_number, ", mean track"),
               group = "mean tracks") %>%
  addPolylines(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293308"),
               lat = ~detection_latitude_mode,
               lng = ~detection_longitude_mode,
               color = "#B5B5B5",
               weight = 1,
               fillOpacity = 0.3,
               dashArray = "1,7",
               label = ~paste0(tag_serial_number, ", mode track"),
               group = "mode tracks") %>%
  addCircleMarkers(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293308"),
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               fillColor = ~pal_dst(date_time),
               radius = 5,
               weight = 0,
               fillOpacity = 0.8,
               label = ~paste0(format(date_time,"%F"), ", ", sex),
               group = "<span style=color:#B5B5B5>tag 308 (female)</span>") %>%

  # add tag 321 ####
    addPolylines(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293321"),
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               color = "#B5B5B5",
               weight = 3,
               opacity = 0.6,
               label = ~tag_serial_number,
               group = "<span style=color:#B5B5B5>tag 321 (male)</span>") %>%
    addPolylines(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293321"),
               lat = ~detection_latitude_mean,
               lng = ~detection_longitude_mean,
               color = "#B5B5B5",
               weight = 1,
               fillOpacity = 0.2,
               opacity = 0.2,
               dashArray = "5,5",
               label = ~paste0(tag_serial_number, ", mean track"),
               group = "mean tracks") %>%
  addPolylines(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293321"),
               lat = ~detection_latitude_mode,
               lng = ~detection_longitude_mode,
               color = "#B5B5B5",
               weight = 1,
               fillOpacity = 0.3,
               dashArray = "1,7",
               label = ~paste0(tag_serial_number, ", mode track"),
               group = "mode tracks") %>%
  addCircleMarkers(data = masterias_dst_geolocation_output %>% filter(tag_serial_number == "1293321"),
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               fillColor = ~pal_dst(date_time),
               radius = 5,
               weight = 0,
               fillOpacity = 0.8,
               label = ~paste0(format(date_time,"%F"), ", ", sex),
               group = "<span style=color:#B5B5B5>tag 321 (male)</span>")  %>%
  # ADD CONTROLS #####
  leafem::addMouseCoordinates() %>%
  addLayersControl(position = "topright",
                   baseGroups = c("EMODnet bathymetry", "satellite"),
                   overlayGroups = c("<span style=color:#D43F3A>tag 295</span>", "<span style=color:#EEA236>tag 304</span>", "<span style=color:#5CB85C>tag 310</span>", "<span style=color:#46B8DA>tag 312</span>", "<span style=color:#357EBD>tag 319</span>", "<span style=color:#9632B8>tag 322</span>", "<span style=color:#B5B5B5>tag 308 (female)</span>", "<span style=color:#B5B5B5>tag 321 (male)</span>","mean tracks", "mode tracks", "wrecks, OWFs, cables"),
                   options = layersControlOptions(collapsed = FALSE)) %>% 
  hideGroup(c("<span style=color:#B5B5B5>tag 308 (female)</span>", "<span style=color:#B5B5B5>tag 321 (male)</span>", "mean tracks", "mode tracks")) %>%
    addLegend(position = "topleft",
            colors = legend_dates %>% as.POSIXct() %>% pal_dst(),
            labels = legend_dates, opacity = 1,
            title = "Dates")

map_dst

```

### info

```{r info_shorttermDST}
#| include: true
knitr::kable(masterias_info %>% filter(tag_serial_number %in% c("1293295", "1293304", "1293310", "1293312", "1293319", "1293322")) %>% dplyr::select(animal_id, tag_serial_number, tag_type, scientific_name, capture_depth, release_date_time, release_latitude, release_longitude, recapture_date_time, length1, length1_unit, weight, weight_unit, sex, life_stage, detected) %>% relocate(tag_serial_number, release_date_time, detected, sex, life_stage, length1, length1_unit, weight, weight_unit, capture_depth, recapture_date_time))
```
:::

-   Looking at the 6 tracks in more detail, it strikes that 3 sharks swam to the wind farms while 3 sharks stayed very close to the release location, namely tag 304 (female, `r mpts_short %>% filter(tag_serial_number == "1293304") %>% nrow()` days of liberty), tag 310 (male, `r mpts_short %>% filter(tag_serial_number == "1293310") %>% nrow()` days of liberty) and tag 312 (females, `r mpts_short %>% filter(tag_serial_number == "1293312") %>% nrow()` days of liberty). Those 3 sharks were released in 2019.

<!-- -   It's hard to say if they followed the submarine cables to the OWFs... -->

<!-- ## Read in Vertical Data -->

<!-- pressure sensor details:  maximum depth 68 m, accuracy ±1.0, sampling rate: 0.5 Hz. -->

<!-- ```{r read_presslog} -->
<!-- colnames <- c("ADST DATA LOG", "1.0.0", "AdstConverter-1.0.5", "...4", "...5", "...6", "...7", "...8", "...9", "...10", "...11") -->
<!-- press_295 <- read_csv(paste0(dir_path, "/dst_data/02_pressure_temperature/ADST_log_SN1293295/SN1293295_pressure_log.csv"), show_col_types = FALSE, col_names = colnames) -->
<!-- press_304 <- read_csv(paste0(dir_path, "/dst_data/02_pressure_temperature/ADST_log_SN1293304/SN1293304_pressure_log.csv"), show_col_types = FALSE, col_names = colnames) -->
<!-- press_308 <- read_csv(paste0(dir_path, "/dst_data/02_pressure_temperature/ADST_log_SN1293308/SN1293308_pressure_log.csv"), show_col_types = FALSE, col_names = colnames) -->
<!-- press_310 <- read_csv(paste0(dir_path, "/dst_data/02_pressure_temperature/ADST_log_SN1293310/SN1293310_pressure_log.csv"), show_col_types = FALSE, col_names = colnames) -->
<!-- press_312 <- read_csv(paste0(dir_path, "/dst_data/02_pressure_temperature/ADST_log_SN1293312/SN1293312_pressure_log.csv"), show_col_types = FALSE, col_names = colnames) -->
<!-- press_319 <- read_csv(paste0(dir_path, "/dst_data/02_pressure_temperature/ADST_log_SN1293319/SN1293319_pressure_log.csv"), show_col_types = FALSE, col_names = colnames) -->
<!-- press_322 <- read_csv(paste0(dir_path, "/dst_data/02_pressure_temperature/ADST_log_SN1293322/SN1293322_pressure_log.csv"), show_col_types = FALSE, col_names = colnames) -->
<!-- press_321 <- read_csv(paste0(dir_path, "/dst_data/02_pressure_temperature/ADST_log_SN1293321/SN1293321_pressure_log.csv"), show_col_types = FALSE, col_names = colnames) -->

<!-- ``` -->

<!-- ```{r read_templog} -->
<!-- temp_295 <- read_csv(paste0(dir_path, "/dst_data/02_pressure_temperature/ADST_log_SN1293295/SN1293295_temperature_log.csv"), show_col_types = FALSE, col_names = colnames) -->
<!-- temp_304 <- read_csv(paste0(dir_path, "/dst_data/02_pressure_temperature/ADST_log_SN1293304/SN1293304_temperature_log.csv"), show_col_types = FALSE, col_names = colnames) -->
<!-- temp_308 <- read_csv(paste0(dir_path, "/dst_data/02_pressure_temperature/ADST_log_SN1293308/SN1293308_temperature_log.csv"), show_col_types = FALSE, col_names = colnames) -->
<!-- temp_310 <- read_csv(paste0(dir_path, "/dst_data/02_pressure_temperature/ADST_log_SN1293310/SN1293310_temperature_log.csv"), show_col_types = FALSE, col_names = colnames) -->
<!-- temp_312 <- read_csv(paste0(dir_path, "/dst_data/02_pressure_temperature/ADST_log_SN1293312/SN1293312_temperature_log.csv"), show_col_types = FALSE, col_names = colnames) -->
<!-- temp_319 <- read_csv(paste0(dir_path, "/dst_data/02_pressure_temperature/ADST_log_SN1293319/SN1293319_temperature_log.csv"), show_col_types = FALSE, col_names = colnames) -->
<!-- temp_322 <- read_csv(paste0(dir_path, "/dst_data/02_pressure_temperature/ADST_log_SN1293322/SN1293322_temperature_log.csv"), show_col_types = FALSE, col_names = colnames) -->
<!-- temp_321 <- read_csv(paste0(dir_path, "/dst_data/02_pressure_temperature/ADST_log_SN1293321/SN1293321_temperature_log.csv"), show_col_types = FALSE, col_names = colnames) -->
<!-- ``` -->

<!-- ```{r wrangle_temppress} -->
<!-- press_temp_295 <- create_press_temp(press_295, temp_295, "1293295", cutoff_days = 10) -->
<!-- press_temp_304 <- create_press_temp(press_304, temp_304, "1293304", cutoff_days = 10) -->
<!-- press_temp_308 <- create_press_temp(press_308, temp_308, "1293308", cutoff_days = 100) -->
<!-- press_temp_310 <- create_press_temp(press_310, temp_310, "1293310", cutoff_days = 10) -->
<!-- press_temp_312 <- create_press_temp(press_312, temp_312, "1293312", cutoff_days = 10) -->
<!-- press_temp_319 <- create_press_temp(press_319, temp_319, "1293319", cutoff_days = 10) -->
<!-- press_temp_322 <- create_press_temp(press_322, temp_322, "1293322", cutoff_days = 10) -->
<!-- press_temp_321 <- create_press_temp(press_321, temp_321, "1293321", cutoff_days = 100) -->

<!-- # remove unneeded files -->
<!-- # rm(temp_295, temp_304, temp_310, temp_312, temp_319, temp_322, -->
<!-- #    press_295, press_304, press_310, press_312, press_319, press_322) -->
<!-- ``` -->

## depth and temperature profiles

::: {.panel-tabset}
### tag 295

This shark (male) swam out to the OWF. Comment on ETN: *Washed ashore around 27/09/2018 Found at Westenschouwen, tussen domeinen twee en t oude Vuurpad.*

```{r depth_plot_295}
#| include: true
# plot <- 
  ggplot() +
  geom_point(data = masterias_depth_temp %>% filter(tag_serial_number == "1293295"), aes(x = date_time, y = -depth_m, color = temp_c)) +
  scale_y_continuous(breaks = c(0, -10, -20, -30, -40, -50, -60, -70)) +
  labs(y = "Depth in m", x = "Date", color = "Temperature in C") +
  scale_colour_distiller(palette ="RdYlBu") +
  theme_dark()
# plotly::ggplotly(plot)
```

### tag 304

This shark (female) stayed in the Oosterscheldt.

```{r depth_plot_304}
#| include: true
# plot <- 
  ggplot() +
  geom_point(data = masterias_depth_temp %>% filter(tag_serial_number == "1293304"), aes(x = date_time, y = -depth_m, color = temp_c)) +
  scale_y_continuous(breaks = c(0, -10, -20, -30, -40, -50, -60, -70)) +
  labs(y = "Depth in m", x = "Date", color = "Temperature in C") +
  scale_colour_distiller(palette ="RdYlBu") +
  theme_dark()
# plotly::ggplotly(plot)
```

### tag 310

This shark (male) stayed in the Oosterscheldt.

```{r depth_plot_310}
#| include: true
# plot <- 
  ggplot() +
  geom_point(data = masterias_depth_temp %>% filter(tag_serial_number == "1293310"), aes(x = date_time, y = -depth_m, color = temp_c)) +
  scale_y_continuous(breaks = c(0, -10, -20, -30, -40, -50, -60, -70)) +
  labs(y = "Depth in m", x = "Date", color = "Temperature in C") +
  scale_colour_distiller(palette ="RdYlBu") +
  theme_dark()
# plotly::ggplotly(plot)
```

### tag 312

This shark (female) stayed in the Oosterscheldt.

```{r depth_plot_312}
#| include: true
plot <-
  ggplot() +
  geom_point(data = masterias_depth_temp %>% filter(tag_serial_number == "1293312"), aes(x = date_time, y = -depth_m, color = temp_c)) +
  scale_y_continuous(breaks = c(0, -10, -20, -30, -40, -50, -60, -70)) +
  labs(y = "Depth in m", x = "Date", color = "Temperature in C") +
  scale_colour_distiller(palette ="RdYlBu") +
  theme_dark()
plotly::ggplotly(plot)
```

### tag 319

This shark (female) swam out to the OWF. Comment: found on 51°49'32.4"N 3°53'30.4"E (lat 51.825667, lon 3.891778)

```{r depth_plot_319}
#| include: true
# plot <- 
  ggplot() +
  geom_point(data = masterias_depth_temp %>% filter(tag_serial_number == "1293319"), aes(x = date_time, y = -depth_m, color = temp_c)) +
  scale_y_continuous(breaks = c(0, -10, -20, -30, -40, -50, -60, -70)) +
  labs(y = "Depth in m", x = "Date", color = "Temperature in C") +
  scale_colour_distiller(palette ="RdYlBu") +
  theme_dark()
# plotly::ggplotly(plot)
```

### tag 322

This shark (female) swam out to the OWF.

```{r depth_plot_322}
#| include: true
# plot <- 
  ggplot() +
  geom_point(data = masterias_depth_temp %>% filter(tag_serial_number == "1293322"), aes(x = date_time, y = -depth_m, color = temp_c)) +
  scale_y_continuous(breaks = c(0, -10, -20, -30, -40, -50, -60, -70)) +
  labs(y = "Depth in m", x = "Date", color = "Temperature in C") +
  scale_colour_distiller(palette ="RdYlBu") +
  theme_dark()
# plotly::ggplotly(plot)
```
:::

<!-- All of these 6 sharks drift at 20-35 m depth (they are dead?) before surfacing. Can you differentiate any fates here or do you think that would be possible? -->

## depth and temp profiles of long term DST data

These are the profiles of the 2 tags that recorded for over a year.

### tag 308

::: {.panel-tabset}
This shark (female) swam south into the English Channel. The tag logged from 2018-08-02 until 2019-08-03. It does not seem like the animal died at the end of the logging period.

```{r depth_plot_308}
#| include: true
# plot <- 
  ggplot() +
  geom_point(data = masterias_depth_temp %>% filter(tag_serial_number == "1293308"), aes(x = date_time, y = -depth_m, color = temp_c)) +
  scale_y_continuous(breaks = c(0, -10, -20, -30, -40, -50, -60, -70)) +
  labs(y = "Depth in m", x = "Date", color = "Temperature in C") +
  scale_colour_distiller(palette ="RdYlBu") +
  theme_dark()
# plotly::ggplotly(plot)
```

Between October 2018 and April 2019, this female dove deeper than the tag's pressure sensor limit of \~75m. What could this mean?

```{r basemapsnippets}

# for emodnet layer
emodnet_tiles <-"https://tiles.emodnet-bathymetry.eu/2020/baselayer/web_mercator/{z}/{x}/{y}.png"
cite_emodnet <- "<a href='https://emodnet.ec.europa.eu'>EMODnet</a>"
  attr(cite_emodnet, "class") <- c("html", "character")
  

basemap_snippets <- leaflet::leaflet(
  # options = leaflet::leafletOptions(crs = leaflet::leafletCRS("L.CRS.EPSG4326"))
                                  ) %>%
  # ADD BASELAYERS ####
  addProviderTiles("Esri.WorldImagery", options = providerTileOptions(opacity = 0.6), group = "satellite") %>%
  leaflet::addTiles(urlTemplate = emodnet_tiles,
      # options = leaflet::tileOptions(tms = FALSE),
      attribution = cite_emodnet,
      group = "EMODnet bathymetry") %>%
  # SCALEBAR ####
  addScaleBar(position = "topright", options = scaleBarOptions(maxWidth = 250, imperial = F)) %>%
  setView(3.3, 51.5, zoom = 8) %>% 
  #### BPNS ####
  addPolygons(data = BPNS, color = "grey", 
              weight = 2,
              opacity = 1.0,
              fillOpacity = 0, 
              group = "Regions") %>%
    #### submarine cables ####
  addPolylines(data = cables,
               color = "blue",
               opacity = 0.15,
               label = ~name,
               group = "wrecks, OWFs, cables") %>%
  #### windfarms ####
  addPolygons(data = windfarms_polygons %>% filter(!status %in% c("Approved", "Planned")),
              color = "red",
              weight = 2,
              opacity = 1,
              fillOpacity = 0.3,
              label = ~paste0("status: ", status, ", country: ", country, ", year: ", year),
              group = "wrecks, OWFs, cables") %>%
  #### shipwrecks ####
  addCircleMarkers(data = wrecks,
                 fillColor = "lightgreen",
                 opacity = 0,
                 fillOpacity = 1,
                 radius = 3,
                 label = ~paste0("Object: ", obj_type, ", sink year: ", sink_yr),
                 group = "wrecks, OWFs, cables") %>%
  addCircleMarkers(data = wrecks_BE %>% filter(Staat != "Geborgen"),
                   lng = ~longitude,
                   lat = ~latitude,
                   fillColor = "lightgreen",
                   opacity = 0,
                   fillOpacity = 1,
                   radius = 3,
                   label = ~paste0("Object: ", Type, ", sink date: ", sink_yr, ", status: ", Staat, ", material: ", Materiaal, ", name: ", Naam),
                   group = "wrecks, OWFs, cables") #%>%
  
basemap_snippets

```

#### WS - Channel

```{r tag308WSChannel}
#| include: true

data <- masterias_dst_geolocation_output %>% filter(date_time %>% between("2018-08-02" %>% as.POSIXct(tz = "UTC"), "2018-10-09" %>% as.POSIXct(tz = "UTC")),
                    tag_serial_number == "1293308")

# for the long term DST tracks
pal_dst <- colorNumeric(palette = "magma", domain = data$date_time) 

legend_dates = c("2018-08-03", "2018-08-15", "2018-08-30", "2018-09-15", "2018-09-30", "2018-10-09")

map_308_1_WS_Channel <- basemap_snippets %>%
  # add tag 308 ####
    addPolylines(data = data,
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               color = "#B5B5B5",
               weight = 3,
               opacity = 0.6,
               label = ~tag_serial_number,
               group = "tag 308 (female)") %>%
    addPolylines(data = data,
               lat = ~detection_latitude_mean,
               lng = ~detection_longitude_mean,
               color = "#B5B5B5",
               weight = 1,
               fillOpacity = 0.2,
               opacity = 0.2,
               dashArray = "5,5",
               label = ~paste0(tag_serial_number, ", mean track"),
               group = "mean tracks") %>%
  addPolylines(data = data,
               lat = ~detection_latitude_mode,
               lng = ~detection_longitude_mode,
               color = "#B5B5B5",
               weight = 1,
               fillOpacity = 0.3,
               dashArray = "1,7",
               label = ~paste0(tag_serial_number, ", mode track"),
               group = "mode tracks") %>%
  addCircleMarkers(data = data,
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               fillColor = ~pal_dst(date_time),
               radius = 5,
               weight = 0,
               fillOpacity = 0.8,
               label = ~paste0(format(date_time,"%F"), ", ", sex),
               group = "tag 308 (female)") %>%
  # ADD CONTROLS #####
  leafem::addMouseCoordinates() %>%
  addLayersControl(position = "topright",
                   baseGroups = c("EMODnet bathymetry", "satellite"),
                   overlayGroups = c("tag 308 (female)", "mean tracks", "mode tracks", "wrecks, OWFs, cables"),
                   options = layersControlOptions(collapsed = FALSE)) %>% 
  hideGroup(c("mean tracks", "mode tracks")) %>%
    addLegend(position = "topleft",
            colors = legend_dates %>% as.POSIXct() %>% pal_dst(),
            labels = legend_dates, opacity = 1,
            title = "Dates")

# map ####
map_308_1_WS_Channel

# press and temp plot ####

# plot <-
  ggplot() +
  geom_point(data = masterias_depth_temp %>% filter(tag_serial_number == "1293308") %>% filter(date_time %>% between("2018-08-02" %>% as.POSIXct(tz = "UTC"), "2018-10-09" %>% as.POSIXct(tz = "UTC"))), aes(x = date_time, y = -depth_m, color = temp_c)) +
  scale_y_continuous(breaks = c(0, -10, -20, -30, -40, -50, -60, -70)) +
  labs(y = "Depth in m", x = "Date", color = "Temperature in C") +
  scale_colour_distiller(palette ="RdYlBu") +
  theme_dark()
# plotly::ggplotly(plot)

```

#### Winter (Channel)

```{r tag308Channel}
#| include: true
data <- masterias_dst_geolocation_output %>% filter(date_time %>% between("2018-10-09" %>% as.POSIXct(tz = "UTC"), "2019-04-06" %>% as.POSIXct(tz = "UTC")),
                    tag_serial_number == "1293308")

# for the long term DST tracks
pal_dst <- colorNumeric(palette = "magma", domain = data$date_time) 

legend_dates = c("2018-10-10", "2018-11-01", "2018-12-01", "2019-01-01", "2019-02-01", "2019-03-01", "2019-04-06")


map_308_2_Channel <- basemap_snippets %>%
  setView(lat = 50.21, lng = -1.197, zoom = 9) %>%
  # add tag 308 ####
    addPolylines(data = data,
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               color = "#B5B5B5",
               weight = 3,
               opacity = 0.6,
               label = ~tag_serial_number,
               group = "tag 308 (female)") %>%
    addPolylines(data = data,
               lat = ~detection_latitude_mean,
               lng = ~detection_longitude_mean,
               color = "#B5B5B5",
               weight = 1,
               fillOpacity = 0.2,
               opacity = 0.2,
               dashArray = "5,5",
               label = ~paste0(tag_serial_number, ", mean track"),
               group = "mean tracks") %>%
  addPolylines(data = data,
               lat = ~detection_latitude_mode,
               lng = ~detection_longitude_mode,
               color = "#B5B5B5",
               weight = 1,
               fillOpacity = 0.3,
               dashArray = "1,7",
               label = ~paste0(tag_serial_number, ", mode track"),
               group = "mode tracks") %>%
  addCircleMarkers(data = data,
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               fillColor = ~pal_dst(date_time),
               radius = 5,
               weight = 0,
               fillOpacity = 0.8,
               label = ~paste0(format(date_time,"%F"), ", ", sex),
               group = "tag 308 (female)") %>%
  # ADD CONTROLS #####
  leafem::addMouseCoordinates() %>%
  addLayersControl(position = "topright",
                   baseGroups = c("EMODnet bathymetry", "satellite"),
                   overlayGroups = c("tag 308 (female)", "mean tracks", "mode tracks", "wrecks, OWFs, cables"),
                   options = layersControlOptions(collapsed = FALSE)) %>% 
  hideGroup(c("mean tracks", "mode tracks")) %>%
    addLegend(position = "topleft",
            colors = legend_dates %>% as.POSIXct() %>% pal_dst(),
            labels = legend_dates, opacity = 1,
            title = "Dates")

# map ####
map_308_2_Channel

# press and temp plot ####

# plot <-
  ggplot() +
  geom_point(data = masterias_depth_temp %>% filter(tag_serial_number == "1293308") %>% filter(date_time %>% between("2018-10-09" %>% as.POSIXct(tz = "UTC"), "2019-04-06" %>% as.POSIXct(tz = "UTC"))), aes(x = date_time, y = -depth_m, color = temp_c)) +
  scale_y_continuous(breaks = c(0, -10, -20, -30, -40, -50, -60, -70)) +
  labs(y = "Depth in m", x = "Date", color = "Temperature in C") +
  scale_colour_distiller(palette ="RdYlBu") +
  theme_dark()
# plotly::ggplotly(plot)

```

#### Channel - WS

```{r tag308ChannelWS}
#| include: true
data <- masterias_dst_geolocation_output %>% filter(date_time %>% between("2019-04-06" %>% as.POSIXct(tz = "UTC"), "2019-05-12" %>% as.POSIXct(tz = "UTC")),
                    tag_serial_number == "1293308")

# for the long term DST tracks
pal_dst <- colorNumeric(palette = "magma", domain = data$date_time) 

legend_dates = c("2019-04-07", "2019-04-20", "2019-05-12")


map_308_3_Channel_WS <- basemap_snippets %>%
  setView(lat = 50.6, lng = 0.5, zoom = 8) %>%
  # add tag 308 ####
    addPolylines(data = data,
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               color = "#B5B5B5",
               weight = 3,
               opacity = 0.6,
               label = ~tag_serial_number,
               group = "tag 308 (female)") %>%
    addPolylines(data = data,
               lat = ~detection_latitude_mean,
               lng = ~detection_longitude_mean,
               color = "#B5B5B5",
               weight = 1,
               fillOpacity = 0.2,
               opacity = 0.2,
               dashArray = "5,5",
               label = ~paste0(tag_serial_number, ", mean track"),
               group = "mean tracks") %>%
  addPolylines(data = data,
               lat = ~detection_latitude_mode,
               lng = ~detection_longitude_mode,
               color = "#B5B5B5",
               weight = 1,
               fillOpacity = 0.3,
               dashArray = "1,7",
               label = ~paste0(tag_serial_number, ", mode track"),
               group = "mode tracks") %>%
  addCircleMarkers(data = data,
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               fillColor = ~pal_dst(date_time),
               radius = 5,
               weight = 0,
               fillOpacity = 0.8,
               label = ~paste0(format(date_time,"%F"), ", ", sex),
               group = "tag 308 (female)") %>%
  # ADD CONTROLS #####
  leafem::addMouseCoordinates() %>%
  addLayersControl(position = "topright",
                   baseGroups = c("EMODnet bathymetry", "satellite"),
                   overlayGroups = c("tag 308 (female)", "mean tracks", "mode tracks", "wrecks, OWFs, cables"),
                   options = layersControlOptions(collapsed = FALSE)) %>% 
  hideGroup(c("mean tracks", "mode tracks")) %>%
    addLegend(position = "topleft",
            colors = legend_dates %>% as.POSIXct() %>% pal_dst(),
            labels = legend_dates, opacity = 1,
            title = "Dates")

# map ####
map_308_3_Channel_WS

# press and temp plot ####

# plot <-
  ggplot() +
  geom_point(data = masterias_depth_temp %>% filter(tag_serial_number == "1293308") %>% filter(date_time %>% between("2019-04-06" %>% as.POSIXct(tz = "UTC"), "2019-05-12" %>% as.POSIXct(tz = "UTC"))), aes(x = date_time, y = -depth_m, color = temp_c)) +
  scale_y_continuous(breaks = c(0, -10, -20, -30, -40, -50, -60, -70)) +
  labs(y = "Depth in m", x = "Date", color = "Temperature in C") +
  scale_colour_distiller(palette ="RdYlBu") +
  theme_dark()
# plotly::ggplotly(plot)
```

#### Summer (WS)

```{r tag308WS_1}
#| include: true

data <- masterias_dst_geolocation_output %>% filter(date_time %>% between("2019-05-13" %>% as.POSIXct(tz = "UTC"), "2019-06-12" %>% as.POSIXct(tz = "UTC")),
                    tag_serial_number == "1293308")

# for the long term DST tracks
pal_dst <- colorNumeric(palette = "magma", domain = data$date_time) 

legend_dates = c("2019-05-14", "2019-05-20", "2019-05-30", "2019-06-12")


map_308_4_WS_1 <- basemap_snippets %>%
  addTiles(group = "OpenStreetMap") %>%
  setView(lat = 51.45, lng = 3.5, zoom = 12) %>%
  # add tag 308 ####
    addPolylines(data = data,
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               color = "#B5B5B5",
               weight = 3,
               opacity = 0.6,
               label = ~tag_serial_number,
               group = "tag 308 (female)") %>%
    addPolylines(data = data,
               lat = ~detection_latitude_mean,
               lng = ~detection_longitude_mean,
               color = "#B5B5B5",
               weight = 1,
               fillOpacity = 0.2,
               opacity = 0.2,
               dashArray = "5,5",
               label = ~paste0(tag_serial_number, ", mean track"),
               group = "mean tracks") %>%
  addPolylines(data = data,
               lat = ~detection_latitude_mode,
               lng = ~detection_longitude_mode,
               color = "#B5B5B5",
               weight = 1,
               fillOpacity = 0.3,
               dashArray = "1,7",
               label = ~paste0(tag_serial_number, ", mode track"),
               group = "mode tracks") %>%
  addCircleMarkers(data = data,
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               fillColor = ~pal_dst(date_time),
               radius = 5,
               weight = 0,
               fillOpacity = 0.8,
               label = ~paste0(format(date_time,"%F"), ", ", sex),
               group = "tag 308 (female)") %>%
  # ADD CONTROLS #####
  leafem::addMouseCoordinates() %>%
  addLayersControl(position = "topright",
                   baseGroups = c("EMODnet bathymetry", "satellite", "OpenStreetMap"),
                   overlayGroups = c("tag 308 (female)", "mean tracks", "mode tracks", "wrecks, OWFs, cables"),
                   options = layersControlOptions(collapsed = FALSE)) %>% 
  hideGroup(c("mean tracks", "mode tracks")) %>%
    addLegend(position = "topleft",
            colors = legend_dates %>% as.POSIXct() %>% pal_dst(),
            labels = legend_dates, opacity = 1,
            title = "Dates")

# map ####
map_308_4_WS_1

# press and temp plot ####

# plot <-
  ggplot() +
  geom_point(data = masterias_depth_temp %>% filter(tag_serial_number == "1293308") %>% filter(date_time %>% between("2019-05-13" %>% as.POSIXct(tz = "UTC"), "2019-06-12" %>% as.POSIXct(tz = "UTC"))), aes(x = date_time, y = -depth_m, color = temp_c)) +
  scale_y_continuous(breaks = c(0, -10, -20, -30, -40, -50, -60, -70)) +
  labs(y = "Depth in m", x = "Date", color = "Temperature in C") +
  scale_colour_distiller(palette ="RdYlBu") +
  theme_dark()
# plotly::ggplotly(plot)
```

```{r tag308WS_2}
#| include: true

data <- masterias_dst_geolocation_output %>% filter(date_time %>% between("2019-06-12" %>% as.POSIXct(tz = "UTC"), "2019-08-03" %>% as.POSIXct(tz = "UTC")),
                    tag_serial_number == "1293308")

# for the long term DST tracks
pal_dst <- colorNumeric(palette = "magma", domain = data$date_time) 

legend_dates = c("2019-06-13", "2019-07-01", "2019-07-15", "2019-08-03")


map_308_5_WS_2 <- basemap_snippets %>%
  addTiles(group = "OpenStreetMap") %>%
  setView(lat = 51.45, lng = 3.5, zoom = 12) %>%
  # add tag 308 ####
    addPolylines(data = data,
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               color = "#B5B5B5",
               weight = 3,
               opacity = 0.6,
               label = ~tag_serial_number,
               group = "tag 308 (female)") %>%
    addPolylines(data = data,
               lat = ~detection_latitude_mean,
               lng = ~detection_longitude_mean,
               color = "#B5B5B5",
               weight = 1,
               fillOpacity = 0.2,
               opacity = 0.2,
               dashArray = "5,5",
               label = ~paste0(tag_serial_number, ", mean track"),
               group = "mean tracks") %>%
  addPolylines(data = data,
               lat = ~detection_latitude_mode,
               lng = ~detection_longitude_mode,
               color = "#B5B5B5",
               weight = 1,
               fillOpacity = 0.3,
               dashArray = "1,7",
               label = ~paste0(tag_serial_number, ", mode track"),
               group = "mode tracks") %>%
  addCircleMarkers(data = data,
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               fillColor = ~pal_dst(date_time),
               radius = 5,
               weight = 0,
               fillOpacity = 0.8,
               label = ~paste0(format(date_time,"%F"), ", ", sex),
               group = "tag 308 (female)") %>%
  # ADD CONTROLS #####
  leafem::addMouseCoordinates() %>%
  addLayersControl(position = "topright",
                   baseGroups = c("EMODnet bathymetry", "satellite", "OpenStreetMap"),
                   overlayGroups = c("tag 308 (female)", "mean tracks", "mode tracks", "wrecks, OWFs, cables"),
                   options = layersControlOptions(collapsed = FALSE)) %>% 
  hideGroup(c("mean tracks", "mode tracks")) %>%
    addLegend(position = "topleft",
            colors = legend_dates %>% as.POSIXct() %>% pal_dst(),
            labels = legend_dates, opacity = 1,
            title = "Dates")

# map ####
map_308_5_WS_2

# press and temp plot ####

# plot <-
  ggplot() +
  geom_point(data = masterias_depth_temp %>% filter(tag_serial_number == "1293308") %>% filter(date_time %>% between("2019-06-13" %>% as.POSIXct(tz = "UTC"), "2019-08-03" %>% as.POSIXct(tz = "UTC"))), aes(x = date_time, y = -depth_m, color = temp_c)) +
  scale_y_continuous(breaks = c(0, -10, -20, -30, -40, -50, -60, -70)) +
  labs(y = "Depth in m", x = "Date", color = "Temperature in C") +
  scale_colour_distiller(palette ="RdYlBu") +
  theme_dark()
# plotly::ggplotly(plot)
```
:::

### tag 321

::: {.panel-tabset}

This shark (male) swam north into the Southern North Sea.

```{r depth_plot_321}
#| include: true
# plot <- 
  ggplot() +
  geom_point(data = masterias_depth_temp %>% filter(tag_serial_number == "1293321"), aes(x = date_time, y = -depth_m, color = temp_c)) +
  scale_y_continuous(breaks = c(0, -10, -20, -30, -40, -50, -60, -70)) +
  labs(y = "Depth in m", x = "Date", color = "Temperature in C") +
  scale_colour_distiller(palette ="RdYlBu") +
  theme_dark()
# plotly::ggplotly(plot)
```

The male stayed at the surface much more compared to the female. What might he have done? 

#### WS - North Sea

```{r tag321WSNorthSea}
#| include: true

data <- masterias_dst_geolocation_output %>% filter(date_time %>% between("2018-07-19" %>% as.POSIXct(tz = "UTC"), "2018-10-22" %>% as.POSIXct(tz = "UTC")),
                    tag_serial_number == "1293321")

# for the long term DST tracks
pal_dst <- colorNumeric(palette = "magma", domain = data$date_time) 

legend_dates = c("2018-07-20", "2018-08-15", "2018-08-30", "2018-09-15", "2018-09-30", "2018-10-22")

map_321_1_WS_NorthSea <- basemap_snippets %>%
  # add tag 321 ####
    addPolylines(data = data,
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               color = "#B5B5B5",
               weight = 3,
               opacity = 0.6,
               label = ~tag_serial_number,
               group = "tag 321 (male)") %>%
    addPolylines(data = data,
               lat = ~detection_latitude_mean,
               lng = ~detection_longitude_mean,
               color = "#B5B5B5",
               weight = 1,
               fillOpacity = 0.2,
               opacity = 0.2,
               dashArray = "5,5",
               label = ~paste0(tag_serial_number, ", mean track"),
               group = "mean tracks") %>%
  addPolylines(data = data,
               lat = ~detection_latitude_mode,
               lng = ~detection_longitude_mode,
               color = "#B5B5B5",
               weight = 1,
               fillOpacity = 0.3,
               dashArray = "1,7",
               label = ~paste0(tag_serial_number, ", mode track"),
               group = "mode tracks") %>%
  addCircleMarkers(data = data,
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               fillColor = ~pal_dst(date_time),
               radius = 5,
               weight = 0,
               fillOpacity = 0.8,
               label = ~paste0(format(date_time,"%F"), ", ", sex),
               group = "tag 321 (male)") %>%
  # ADD CONTROLS #####
  leafem::addMouseCoordinates() %>%
  addLayersControl(position = "topright",
                   baseGroups = c("EMODnet bathymetry", "satellite"),
                   overlayGroups = c("tag 321 (male)", "mean tracks", "mode tracks", "wrecks, OWFs, cables"),
                   options = layersControlOptions(collapsed = FALSE)) %>% 
  hideGroup(c("mean tracks", "mode tracks")) %>%
    addLegend(position = "topleft",
            colors = legend_dates %>% as.POSIXct() %>% pal_dst(),
            labels = legend_dates, opacity = 1,
            title = "Dates")

# map ####
map_321_1_WS_NorthSea

# press and temp plot ####

# plot <-
  ggplot() +
  geom_point(data = masterias_depth_temp %>% filter(tag_serial_number == "1293321") %>% filter(date_time %>% between("2018-07-19" %>% as.POSIXct(tz = "UTC"), "2018-10-22" %>% as.POSIXct(tz = "UTC"))), aes(x = date_time, y = -depth_m, color = temp_c)) +
  scale_y_continuous(breaks = c(0, -10, -20, -30, -40, -50, -60, -70)) +
  labs(y = "Depth in m", x = "Date", color = "Temperature in C") +
  scale_colour_distiller(palette ="RdYlBu") +
  theme_dark()
# plotly::ggplotly(plot)

```

#### North Sea

```{r tag321NorthSea}
#| include: true

data <- masterias_dst_geolocation_output %>% filter(date_time %>% between("2018-10-23" %>% as.POSIXct(tz = "UTC"), "2019-04-23" %>% as.POSIXct(tz = "UTC")),
                    tag_serial_number == "1293321")

# for the long term DST tracks
pal_dst <- colorNumeric(palette = "magma", domain = data$date_time) 

legend_dates = c("2018-10-24", "2018-12-01", "2019-01-01", "2019-02-01", "2019-03-01", "2019-04-22")

map_321_2_NorthSea <- basemap_snippets %>%
  # add tag 321 ####
    addPolylines(data = data,
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               color = "#B5B5B5",
               weight = 3,
               opacity = 0.6,
               label = ~tag_serial_number,
               group = "tag 321 (male)") %>%
    addPolylines(data = data,
               lat = ~detection_latitude_mean,
               lng = ~detection_longitude_mean,
               color = "#B5B5B5",
               weight = 1,
               fillOpacity = 0.2,
               opacity = 0.2,
               dashArray = "5,5",
               label = ~paste0(tag_serial_number, ", mean track"),
               group = "mean tracks") %>%
  addPolylines(data = data,
               lat = ~detection_latitude_mode,
               lng = ~detection_longitude_mode,
               color = "#B5B5B5",
               weight = 1,
               fillOpacity = 0.3,
               dashArray = "1,7",
               label = ~paste0(tag_serial_number, ", mode track"),
               group = "mode tracks") %>%
  addCircleMarkers(data = data,
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               fillColor = ~pal_dst(date_time),
               radius = 5,
               weight = 0,
               fillOpacity = 0.8,
               label = ~paste0(format(date_time,"%F"), ", ", sex),
               group = "tag 321 (male)") %>%
  # ADD CONTROLS #####
  leafem::addMouseCoordinates() %>%
  addLayersControl(position = "topright",
                   baseGroups = c("EMODnet bathymetry", "satellite"),
                   overlayGroups = c("tag 321 (male)", "mean tracks", "mode tracks", "wrecks, OWFs, cables"),
                   options = layersControlOptions(collapsed = FALSE)) %>% 
  hideGroup(c("mean tracks", "mode tracks")) %>%
    addLegend(position = "topleft",
            colors = legend_dates %>% as.POSIXct() %>% pal_dst(),
            labels = legend_dates, opacity = 1,
            title = "Dates")

# map ####
map_321_2_NorthSea

# press and temp plot ####

# plot <-
  ggplot() +
  geom_point(data = masterias_depth_temp %>% filter(tag_serial_number == "1293321") %>% filter(date_time %>% between("2018-10-23" %>% as.POSIXct(tz = "UTC"), "2019-04-23" %>% as.POSIXct(tz = "UTC"))), aes(x = date_time, y = -depth_m, color = temp_c)) +
  scale_y_continuous(breaks = c(0, -10, -20, -30, -40, -50, -60, -70)) +
  labs(y = "Depth in m", x = "Date", color = "Temperature in C") +
  scale_colour_distiller(palette ="RdYlBu") +
  theme_dark()
# plotly::ggplotly(plot)

```



#### North Sea - BPNS

```{r tag321NorthSeaBPNS}
#| include: true

data <- masterias_dst_geolocation_output %>% filter(date_time %>% between("2019-04-23" %>% as.POSIXct(tz = "UTC"), "2019-05-10" %>% as.POSIXct(tz = "UTC")),
                    tag_serial_number == "1293321")

# for the long term DST tracks
pal_dst <- colorNumeric(palette = "magma", domain = data$date_time) 

legend_dates = c("2019-04-24", "2019-05-01", "2019-05-10")

map_321_3_NorthSeaBPNS <- basemap_snippets %>%
  # add tag 321 ####
    addPolylines(data = data,
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               color = "#B5B5B5",
               weight = 3,
               opacity = 0.6,
               label = ~tag_serial_number,
               group = "tag 321 (male)") %>%
    addPolylines(data = data,
               lat = ~detection_latitude_mean,
               lng = ~detection_longitude_mean,
               color = "#B5B5B5",
               weight = 1,
               fillOpacity = 0.2,
               opacity = 0.2,
               dashArray = "5,5",
               label = ~paste0(tag_serial_number, ", mean track"),
               group = "mean tracks") %>%
  addPolylines(data = data,
               lat = ~detection_latitude_mode,
               lng = ~detection_longitude_mode,
               color = "#B5B5B5",
               weight = 1,
               fillOpacity = 0.3,
               dashArray = "1,7",
               label = ~paste0(tag_serial_number, ", mode track"),
               group = "mode tracks") %>%
  addCircleMarkers(data = data,
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               fillColor = ~pal_dst(date_time),
               radius = 5,
               weight = 0,
               fillOpacity = 0.8,
               label = ~paste0(format(date_time,"%F"), ", ", sex),
               group = "tag 321 (male)") %>%
  # ADD CONTROLS #####
  leafem::addMouseCoordinates() %>%
  addLayersControl(position = "topright",
                   baseGroups = c("EMODnet bathymetry", "satellite"),
                   overlayGroups = c("tag 321 (male)", "mean tracks", "mode tracks", "wrecks, OWFs, cables"),
                   options = layersControlOptions(collapsed = FALSE)) %>% 
  hideGroup(c("mean tracks", "mode tracks")) %>%
    addLegend(position = "topleft",
            colors = legend_dates %>% as.POSIXct() %>% pal_dst(),
            labels = legend_dates, opacity = 1,
            title = "Dates")

# map ####
map_321_3_NorthSeaBPNS

# press and temp plot ####

# plot <-
  ggplot() +
  geom_point(data = masterias_depth_temp %>% filter(tag_serial_number == "1293321") %>% filter(date_time %>% between("2019-04-23" %>% as.POSIXct(tz = "UTC"), "2019-05-10" %>% as.POSIXct(tz = "UTC"))), aes(x = date_time, y = -depth_m, color = temp_c)) +
  scale_y_continuous(breaks = c(0, -10, -20, -30, -40, -50, -60, -70)) +
  labs(y = "Depth in m", x = "Date", color = "Temperature in C") +
  scale_colour_distiller(palette ="RdYlBu") +
  theme_dark()
# plotly::ggplotly(plot)

```



#### BPNS

```{r tag321BPNS}
#| include: true

data <- masterias_dst_geolocation_output %>% filter(date_time %>% between("2019-05-10" %>% as.POSIXct(tz = "UTC"), "2019-05-29" %>% as.POSIXct(tz = "UTC")),
                    tag_serial_number == "1293321")

# for the long term DST tracks
pal_dst <- colorNumeric(palette = "magma", domain = data$date_time) 

legend_dates = c("2019-05-11", "2019-05-15", "2019-05-28")

map_321_4_BPNS <- basemap_snippets %>%
  # add tag 321 ####
    addPolylines(data = data,
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               color = "#B5B5B5",
               weight = 3,
               opacity = 0.6,
               label = ~tag_serial_number,
               group = "tag 321 (male)") %>%
    addPolylines(data = data,
               lat = ~detection_latitude_mean,
               lng = ~detection_longitude_mean,
               color = "#B5B5B5",
               weight = 1,
               fillOpacity = 0.2,
               opacity = 0.2,
               dashArray = "5,5",
               label = ~paste0(tag_serial_number, ", mean track"),
               group = "mean tracks") %>%
  addPolylines(data = data,
               lat = ~detection_latitude_mode,
               lng = ~detection_longitude_mode,
               color = "#B5B5B5",
               weight = 1,
               fillOpacity = 0.3,
               dashArray = "1,7",
               label = ~paste0(tag_serial_number, ", mode track"),
               group = "mode tracks") %>%
  addCircleMarkers(data = data,
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               fillColor = ~pal_dst(date_time),
               radius = 5,
               weight = 0,
               fillOpacity = 0.8,
               label = ~paste0(format(date_time,"%F"), ", ", sex),
               group = "tag 321 (male)") %>%
  # ADD CONTROLS #####
  leafem::addMouseCoordinates() %>%
  addLayersControl(position = "topright",
                   baseGroups = c("EMODnet bathymetry", "satellite"),
                   overlayGroups = c("tag 321 (male)", "mean tracks", "mode tracks", "wrecks, OWFs, cables"),
                   options = layersControlOptions(collapsed = FALSE)) %>% 
  hideGroup(c("mean tracks", "mode tracks")) %>%
    addLegend(position = "topleft",
            colors = legend_dates %>% as.POSIXct() %>% pal_dst(),
            labels = legend_dates, opacity = 1,
            title = "Dates")

# map ####
map_321_4_BPNS

# press and temp plot ####

# plot <-
  ggplot() +
  geom_point(data = masterias_depth_temp %>% filter(tag_serial_number == "1293321") %>% filter(date_time %>% between("2019-05-10" %>% as.POSIXct(tz = "UTC"), "2019-05-28" %>% as.POSIXct(tz = "UTC"))), aes(x = date_time, y = -depth_m, color = temp_c)) +
  scale_y_continuous(breaks = c(0, -10, -20, -30, -40, -50, -60, -70)) +
  labs(y = "Depth in m", x = "Date", color = "Temperature in C") +
  scale_colour_distiller(palette ="RdYlBu") +
  theme_dark()
# plotly::ggplotly(plot)

```




#### BPNS - North Sea

```{r tag321BPNSNorthSea}
#| include: true

data <- masterias_dst_geolocation_output %>% filter(date_time %>% between("2019-05-28" %>% as.POSIXct(tz = "UTC"), "2019-09-21" %>% as.POSIXct(tz = "UTC")),
                    tag_serial_number == "1293321")

# for the long term DST tracks
pal_dst <- colorNumeric(palette = "magma", domain = data$date_time) 

legend_dates = c("2019-05-29", "2019-07-01", "2019-08-01", "2019-09-21")

map_321_5_BPNSNorthSea <- basemap_snippets %>%
  # add tag 321 ####
    addPolylines(data = data,
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               color = "#B5B5B5",
               weight = 3,
               opacity = 0.6,
               label = ~tag_serial_number,
               group = "tag 321 (male)") %>%
    addPolylines(data = data,
               lat = ~detection_latitude_mean,
               lng = ~detection_longitude_mean,
               color = "#B5B5B5",
               weight = 1,
               fillOpacity = 0.2,
               opacity = 0.2,
               dashArray = "5,5",
               label = ~paste0(tag_serial_number, ", mean track"),
               group = "mean tracks") %>%
  addPolylines(data = data,
               lat = ~detection_latitude_mode,
               lng = ~detection_longitude_mode,
               color = "#B5B5B5",
               weight = 1,
               fillOpacity = 0.3,
               dashArray = "1,7",
               label = ~paste0(tag_serial_number, ", mode track"),
               group = "mode tracks") %>%
  addCircleMarkers(data = data,
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               fillColor = ~pal_dst(date_time),
               radius = 5,
               weight = 0,
               fillOpacity = 0.8,
               label = ~paste0(format(date_time,"%F"), ", ", sex),
               group = "tag 321 (male)") %>%
  # ADD CONTROLS #####
  leafem::addMouseCoordinates() %>%
  addLayersControl(position = "topright",
                   baseGroups = c("EMODnet bathymetry", "satellite"),
                   overlayGroups = c("tag 321 (male)", "mean tracks", "mode tracks", "wrecks, OWFs, cables"),
                   options = layersControlOptions(collapsed = FALSE)) %>% 
  hideGroup(c("mean tracks", "mode tracks")) %>%
    addLegend(position = "topleft",
            colors = legend_dates %>% as.POSIXct() %>% pal_dst(),
            labels = legend_dates, opacity = 1,
            title = "Dates")

# map ####
map_321_5_BPNSNorthSea

# press and temp plot ####

# plot <-
  ggplot() +
  geom_point(data = masterias_depth_temp %>% filter(tag_serial_number == "1293321") %>% filter(date_time %>% between("2019-05-28" %>% as.POSIXct(tz = "UTC"), "2019-09-21" %>% as.POSIXct(tz = "UTC"))), aes(x = date_time, y = -depth_m, color = temp_c)) +
  scale_y_continuous(breaks = c(0, -10, -20, -30, -40, -50, -60, -70)) +
  labs(y = "Depth in m", x = "Date", color = "Temperature in C") +
  scale_colour_distiller(palette ="RdYlBu") +
  theme_dark()
# plotly::ggplotly(plot)

```

#### North Sea

```{r tag321NorthSea2}
#| include: true

data <- masterias_dst_geolocation_output %>% filter(date_time %>% between("2019-09-21" %>% as.POSIXct(tz = "UTC"), "2019-11-15" %>% as.POSIXct(tz = "UTC")),
                    tag_serial_number == "1293321")

# for the long term DST tracks
pal_dst <- colorNumeric(palette = "magma", domain = data$date_time) 

legend_dates = c("2019-09-22", "2019-10-30", "2019-11-15")

map_321_6_NorthSea <- basemap_snippets %>%
  # add tag 321 ####
    addPolylines(data = data,
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               color = "#B5B5B5",
               weight = 3,
               opacity = 0.6,
               label = ~tag_serial_number,
               group = "tag 321 (male)") %>%
    addPolylines(data = data,
               lat = ~detection_latitude_mean,
               lng = ~detection_longitude_mean,
               color = "#B5B5B5",
               weight = 1,
               fillOpacity = 0.2,
               opacity = 0.2,
               dashArray = "5,5",
               label = ~paste0(tag_serial_number, ", mean track"),
               group = "mean tracks") %>%
  addPolylines(data = data,
               lat = ~detection_latitude_mode,
               lng = ~detection_longitude_mode,
               color = "#B5B5B5",
               weight = 1,
               fillOpacity = 0.3,
               dashArray = "1,7",
               label = ~paste0(tag_serial_number, ", mode track"),
               group = "mode tracks") %>%
  addCircleMarkers(data = data,
               lat = ~detection_latitude,
               lng = ~detection_longitude,
               fillColor = ~pal_dst(date_time),
               radius = 5,
               weight = 0,
               fillOpacity = 0.8,
               label = ~paste0(format(date_time,"%F"), ", ", sex),
               group = "tag 321 (male)") %>%
  # ADD CONTROLS #####
  leafem::addMouseCoordinates() %>%
  addLayersControl(position = "topright",
                   baseGroups = c("EMODnet bathymetry", "satellite"),
                   overlayGroups = c("tag 321 (male)", "mean tracks", "mode tracks", "wrecks, OWFs, cables"),
                   options = layersControlOptions(collapsed = FALSE)) %>% 
  hideGroup(c("mean tracks", "mode tracks")) %>%
    addLegend(position = "topleft",
            colors = legend_dates %>% as.POSIXct() %>% pal_dst(),
            labels = legend_dates, opacity = 1,
            title = "Dates")

# map ####
map_321_6_NorthSea

# press and temp plot ####

# plot <-
  ggplot() +
  geom_point(data = masterias_depth_temp %>% filter(tag_serial_number == "1293321") %>% filter(date_time %>% between("2019-09-21" %>% as.POSIXct(tz = "UTC"), "2019-11-15" %>% as.POSIXct(tz = "UTC"))), aes(x = date_time, y = -depth_m, color = temp_c)) +
  scale_y_continuous(breaks = c(0, -10, -20, -30, -40, -50, -60, -70)) +
  labs(y = "Depth in m", x = "Date", color = "Temperature in C") +
  scale_colour_distiller(palette ="RdYlBu") +
  theme_dark()
# plotly::ggplotly(plot)

```


:::

<!-- ## what I plan to do now -->

<!-- -   I would like to segment the vertical data logs into behavioural patterns. This was done by Heerah et al., 2017 (<https://doi.org/10.1186/s40462-017-0111-3>). I spent a day with it already, but it is not trivial to format the code to the *M. asterias* DST data. To correctly do this, I would need the help of someone that has already done this. Jolien supervised a thesis in 2020 (Camille Boileau-Locas), that did that as well, but I know she has a lot to do right now. Mathieu Woillez also co-authored the paper by Karine Heerah, so I could contact him as well, potentially. What do you suggest? The method of Heerah et al., 2017 uses STFT, a modified version of FFT. I was thinking that I maybe at first do a regular FFT to look at the periodic patterns of the signals. -->

<!-- -   I would like to assess the fate of the 6 sharks that only logged for \< 1 month. Currently, I have in mind that I could try to find rules and translate that into a fate (e.g. temp rise by xy degrees + regular surfacing intervals = fate_seal). Do you think I have any chances of trying to identify different fates(if there are any)? -->

<!-- -   Griffiths et al., 2020 (<https://doi.org/10.1371/journal.pone.0239480>) did not use any fancy/complex Hidden Markov Models like Heerah but they calculated statistics such as the time spent at certain depth bins, vertical speed, seabed proximity, or vertical movement behaviour (based on a Wilcoxon test). This I would perform as a backup/complementary analysis with secondary priority, because I find the behavioural segmentation more interesting. -->

<!-- -   Do you have any other analyses in mind that could shed light on behavioural patterns of the sharks? -->
:::
